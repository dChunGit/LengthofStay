{% extends 'base.html' %}

{% block title %}
    {% if report %}
        View Report
    {% else %}
        View reports
    {% endif %}
{% endblock %}

{% block content %}

    {% if report_image %}
        <script>
            $(document).ready(function() {
                $.ajaxSetup({cache: false});
                $.get(window.location.origin + "/report?image_id=" + "{{ report_image }}", function(data, status) {
                    if(status=="success") {
                        console.log(data);
                        $("#image").empty().append("<img class=\"img-thumbnail\" style=\"height: 200px\" src=\"data:;base64," + data + "\">");
                    }
                });
            })
        </script>
    {% endif %}

    {% if event %}
        <div class="container-fluid">
            <div class="d-flex justify-content-between p-0" style="border-bottom: 1px solid; border-color: LightGray;">
                {% if report %}
                    <h1>Report for {{ event.title }}</h1>
                {% else %}
                    <h1>Reports for {{ event.title }}</h1>
                {% endif %}
            </div>
            <br>
        </div>
    {% endif %}

    {% if not report %}
        <div class="d-flex justify-content-end">
            <div>
                {% if event %}
                <form class="form-inline md-form mr-auto mb-4" action="{{ url_for('searchreports', event_id=event.id) }}" method="post">
                {% else %}
                <form class="form-inline md-form mr-auto mb-4" action="{{ url_for('searchreports') }}" method="post">
                {% endif %}
                    <input class="form-control mr-sm-2" id="query" name="query" type="text" placeholder="Search" aria-label="Search">
                    <button class="btn btn-primary" type="submit">Search</button>
                </form>
            </div>
        </div>
    {% endif %}

    {% if report %}
        <a href="#" class="list-group-item list-group-item-action">
                <div class="d-flex justify-content-between">
                    <p class="mb-1" style="font-weight: bold">{{ report.username }}:</p>
                    <p class="font-italic">{{ report.time.strftime('%Y-%m-%d %H:%M') }}</p>
                </div>
                <p>{{ report.comments }}</p>
                {% if report_image %}
                    <div id="image">
                        <div class="spinner-border" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </div>
                {% endif %}
            </a>
    {% else %}
        <div class="list-group">
            {% if reports %}
                {% for report in reports %}
                    <a href="{{ url_for('reports', report_id=report.id) }}" class="list-group-item list-group-item-action mb-3">
                        {% if not event %}
                            <p class="font-italic" style="font-weight: bold">{{ report.get_report_event().title }}</p>
                            <hr>
                        {% endif %}
                        <div class="d-flex justify-content-between">
                            <p class="mb-1" style="font-weight: bold">{{ report.username }}:</p>
                            <p class="font-italic">{{ report.time.strftime('%Y-%m-%d %H:%M') }}</p>
                        </div>
                        <p>{{ report.comments }}</p>
                    </a>
                {% endfor %}
            {% endif %}
        </div>
    {% endif%}
    
    <div class="container-fluid mt-3 mb-3">
        <div class="btn-toolbar justify-content-start" role="toolbar">
            <div class="btn-group" role="group">
                {% if event %}
                    <a class="btn btn-primary" href="{{ url_for('view_single_event', event_id=event.id) }}" role="button">Back to Event</a>
                {% else %}
                    <a class="btn btn-primary" href="{{ url_for('view_all_events') }}" role="button">Back to Events</a>
                {% endif %}
            </div>
        </div>
    </div>

{% endblock %}
